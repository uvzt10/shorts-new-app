# أداة إنتاج YouTube Shorts التاريخية (Node.js)

هذه الأداة تبني تطبيق ويب خفيف يعمل على **Node.js 20** مع إطار **Express** لإنتاج مقاطع **YouTube Shorts** عمودية بدقة ‎1080×1920‎ ومدتها 15 ثانية ثم نشرها تلقائيًا أو يدويًا على قناة يوتيوب. تعتمد الواجهة على **htmx** و **Alpine.js** لتقديم تجربة تفاعلية خفيفة باللغة العربية مع دعم كامل للاتجاه من اليمين إلى اليسار.

## المميزات

- وضعان للتشغيل:
  - **تلقائي:** يختار موضوعًا قصصيًا أمريكيًا عشوائيًا يوميًا، يجمع مقاطع فيديو عمودية من **Pexels**، يركبها مع انتقالات ناعمة، يضيف نصًا ثلاثي الأبعاد متحركًا وموسيقى خلفية اختيارية، ثم يرفع النتيجة كـ **Shorts** مع وسم ‎`#shorts`‎ في العنوان أو الوصف. يمكن التحكم في وقت النشر وتفعيل/إيقاف الجدولة من الواجهة.
  - **يدوي:** يسمح للمستخدم بإدخال موضوع إنكليزي يدويًا، أو توليد موضوع آليًا عبر زر، ثم إنشاء الفيديو ورفعه بخصوصية عامة أو غير مدرجة.
- يعتمد على **Pexels Videos API** للبحث عن مقاطع عمودية بجودة *medium* (Full HD) مع تحديد الاتجاه `portrait` ضمن الطلب【766224695947353†L1123-L1132】. تحتوي كل نتيجة على مصفوفة `video_files` التي توفر وصلات لتحميل نسخ متعددة الجودة والأبعاد للمقطع【766224695947353†L913-L944】.
- يضيف مؤثرات نصية ثلاثية الأبعاد متحركة باستخدام فلتر `drawtext` في **FFmpeg**، مع ظل وصندوق شفاف وحركة خفيفة داخل أول ثلاث ثوانٍ.
- يعالج المقاطع ويطبق انتقالات `xfade` بحيث يكون الطول النهائي 15 ثانية بالضبط، مع معدل 30 إطار/ثانية وترميز H.264، ويضيف موسيقى خلفية منخفضة المستوى عند توفرها.
- يرفع الفيديو باستخدام **YouTube Data API** عبر `videos.insert`. لكي يعتبر الفيديو **Shorts** يجب ألا يتجاوز 60 ثانية، ويجب إضافة وسم `#Shorts` إلى العنوان أو الوصف【410394844401262†L94-L100】.

## المتطلبات

- Node.js 20 أو أحدث.
- مفتاح API من Pexels (مجاني).
- بيانات OAuth2 (client ID و client secret) من Google لتمكين رفع الفيديوهات إلى YouTube.
- حساب على YouTube مرتبط بالمشروع وموافق على نطاق **youtube.upload**.
- أداة **FFmpeg** مدمجة عبر حزمة `ffmpeg-static`؛ لا حاجة لتثبيت FFmpeg خارجي.
- حجم المشروع الكامل أقل من ‎512 MB ليعمل على منصة Render المجانية.

## الإعداد

1. انسخ أو حمل محتويات هذا المجلد إلى بيئتك المحلية.
2. أنشئ ملف `.env` في جذر المشروع واستبدل القيم الافتراضية بما يناسبك:

   ```env
   PEXELS_API_KEY=YOUR_PEXELS_KEY
   YOUTUBE_CLIENT_ID=YOUR_GOOGLE_CLIENT_ID
   YOUTUBE_CLIENT_SECRET=YOUR_GOOGLE_CLIENT_SECRET
   YOUTUBE_REDIRECT_URI=http://localhost:3000/oauth2callback
   APP_BASE_URL=http://localhost:3000
   DEFAULT_PRIVACY=public         # public أو unlisted
   AUTO_SCHEDULE_CRON=0 14 * * *  # مثال: تشغيل يومي الساعة 14:00
   AUTO_ENABLED=true              # لتفعيل الوضع التلقائي عند بدء الخادم
   BG_MUSIC_URL=                  # رابط ملف mp3 لموسيقى خلفية اختيارية
   VOICEOVER_ENABLED=false        # احتياطي لتعليق صوتي لاحقًا
   ```

3. ثبت التبعيات (ينصح باستخدام ‎`npm install --omit=dev`‎ للحفاظ على الحجم منخفضًا):

   ```bash
   npm install --omit=dev
   ```

4. شغل الخادم:

   ```bash
   node server.js
   ```

5. افتح متصفحك على `http://localhost:3000`.

6. في أول استخدام ستحتاج لربط حساب يوتيوب. اضغط على زر *إنتاج الفيديو* أو فعّل الوضع التلقائي، وستظهر لك رسالة تطلب الربط. اتبع رابط **ربط الحساب** وسجل الدخول بحساب Google ومنح الصلاحيات. بعد الموافقة سيتم حفظ التوكين في ملف `tmp/token.json` للاستخدام لاحقًا.

7. يمكنك تعديل وقت النشر التلقائي أو تعطيله من تبويب **تلقائي**. لحفظ الإعدادات اضغط زر **حفظ الإعدادات**.

## ملاحظات تنفيذية

- تستخدم عملية الإنتاج دالة `pexelsSearch` لاسترجاع مقاطع مصورة مناسبة عن طريق تحديد الاتجاه `portrait` والحجم `medium` كما ينص توثيق Pexels【766224695947353†L1123-L1132】.
- يتم اختيار أفضل ملف فيديو متاح لكل نتيجة باستخدام معلومات `video_files` التي توفر عرضًا وارتفاعًا ورابط تحميل للمقطع【766224695947353†L913-L944】؛ إذا لم تتوفر نسخة HD يتم استخدام أي نسخة أوسع من 480 بكسل.
- حسب توثيق YouTube، يعتبر الفيديو Shorts عندما يكون أقل من 60 ثانية ويحتوي على الوسم ‎`#Shorts`【410394844401262†L94-L100】؛ لذلك تولد الأداة عنوانًا ووصفًا مناسبين وتضيف هذا الوسم دائمًا.
- يقتصر التطبيق على تحميل فيديوهات ويمنع التعليق الصوتي افتراضيًا للحفاظ على حجم المشروع؛ يمكن إضافة دعم TTS مستقبلًا إذا تم تفعيل `VOICEOVER_ENABLED`.
- كل الملفات المؤقتة والملفات الناتجة تُحفظ في مجلد `tmp/` ويتم تنظيفها بعد كل عملية لإبقاء مساحة العمل صغيرة.

## نشر على Render

للنشر على منصة Render قم بإنشاء خدمة ويب جديدة وأشر إلى هذا المستودع. تأكد من إضافة متغيرات البيئة المذكورة في ملف `.env` عبر لوحة إعدادات Render. لا يحتاج المشروع لأية تبعيات تطويرية، وحجم التثبيت الكامل يبقى ضمن الحد المسموح.